<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rlhf</title>
    <script>
        // hier werden die Videos geladen. Ist es ein Problem, dass die Fuktion async ist? Werden sie deshalb nicht neu geladen?
        async function loadVideos() {
                try {
                    const response = await fetch('/get-videos');
                    if (!response.ok) {
                        throw new Error('Keine Videos gefunden');
                    }
                    const data = await response.json();

                    // Video-Container leeren
                    const videoContainer = document.getElementById('video-container');
                    videoContainer.innerHTML = '';

                    // Videos hinzufügen
                    data.videos.forEach(video => {
                        const videoElement = document.createElement('video');
                        videoElement.controls = true;
                        videoElement.autoplay = true;
                        videoElement.loop = true;
                        videoElement.muted = true;
                        videoElement.width = 400;

                        const sourceElement = document.createElement('source');
                        sourceElement.src = video;
                        sourceElement.type = 'video/mp4';

                        videoElement.appendChild(sourceElement);
                        videoContainer.appendChild(videoElement);
                    });
                } catch (error) {
                    console.error('Fehler beim Laden der Videos:', error);
                    document.getElementById('video-container').innerHTML = '<p>Keine Videos verfügbar.</p>';
                }
            }

            async function checkLabelingCompletion() {
                try {
                    const response = await fetch('/is-labeling-complete');
                    if (!response.ok) {
                        throw new Error('Fehler beim Abfragen des Status.');
                    }

                    const data = await response.json();
                    if (data.complete) {
                        // Pop-Up anzeigen
                        alert("Das Labeln aller Videos ist abgeschlossen! Sie können das Fenster schließen.");
                        
                        // Statusanzeige aktualisieren
                        document.getElementById('status').innerText = "Fertig! Das Fenster kann geschlossen werden.";
                        
                        // Stoppe die weitere Überprüfung
                        clearInterval(labelCheckInterval);
                    }
                } catch (error) {
                    console.error('Fehler beim Überprüfen des Status:', error);
                }
            }

            // Initialisiere regelmäßige Überprüfung
            const labelCheckInterval = setInterval(checkLabelingCompletion, 500);

        // Button-Druck
        async function sendAction(action) {
            const response = await fetch('/button_action', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: action })
            });
            if (response.ok) {
                loadVideos(); // Lade Videos neu, nach Button-Druck, funktioniert das? Vielleicht muss man länger warten, weil neues Video noch nicht fertig?
            }
            const data = await response.json();
            if (data.status) {
                document.getElementById('status').innerText = `Status: ${data.status}`;
            }
        }
        loadVideos();
    </script>
    <!-- Position der Buttons festlegen -->
     <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            justify-content: space-between;
            align-items: center;
        }

        .button-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .button {
            position: absolute;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        #button-top {
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
        }

        #button-left {
            top: 50%;
            left: 40%;
            transform: translateY(-50%);
        }

        #button-right {
            top: 50%;
            right: 40%;
            transform: translateY(-50%);
        }

        #button-bottom {
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
        }

        #button-start {
            bottom: 10px;
            left: 20%;
            transform: translateX(-50%);
        }
    </style>
</head>
<body>
    <!--Videos, nicht statisch festgelegt welche geladen-->
    <h1>Which segment do you prefer?</h1>
    <div id="video-container" style="display: flex; gap: 30px;">
        <p>Keine Videos geladen.</p>
    </div>

    <!-- Buttons -->
    <div class="button-container">
        <button id="button-left" class="button" onclick="sendAction('left')">left</button>
        <button id="button-right" class="button" onclick="sendAction('right')">right</button>
        <button id="button-top" class="button" onclick="sendAction('equal')">equal</button>
        <button id="button-bottom" class="button" onclick="sendAction('none')">none</button>  
        <button id="button-start" class="button" onclick="sendAction('start')">start</button>  
    </div>

    <!-- Statusanzeige (Optional) -->
    <p id="status">Status: (-1, -1)</p>
</body>
</html>